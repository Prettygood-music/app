-- Seed file: 002_test_content.sql
-- Description: Creates test content for development and testing

-- Create test albums for our test artists
INSERT INTO prettygood.albums (
  id, title, artist_id, release_date, genre, type
) VALUES
  ('10000000-0000-0000-0000-000000000001', 'Test Album 1', '00000000-0000-0000-0000-000000000002', '2024-01-01', ARRAY['test', 'rock'], 'album'),
  ('10000000-0000-0000-0000-000000000002', 'Test Album 2', '00000000-0000-0000-0000-000000000002', '2024-02-01', ARRAY['test', 'pop'], 'ep'),
  ('10000000-0000-0000-0000-000000000003', 'Test Album 3', '00000000-0000-0000-0000-000000000003', '2024-01-15', ARRAY['test', 'electronic'], 'album')
ON CONFLICT (id) DO NOTHING;

-- Create test tracks for our test albums
INSERT INTO prettygood.tracks (
  id, title, artist_id, album_id, duration, audio_url, track_number, genre
) VALUES
  -- Tracks for Test Album 1
  ('20000000-0000-0000-0000-000000000001', 'Test Track 1', '00000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000001', 180, 'https://test.example.com/tracks/test1.mp3', 1, ARRAY['test', 'rock']),
  ('20000000-0000-0000-0000-000000000002', 'Test Track 2', '00000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000001', 210, 'https://test.example.com/tracks/test2.mp3', 2, ARRAY['test', 'rock']),
  ('20000000-0000-0000-0000-000000000003', 'Test Track 3', '00000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000001', 195, 'https://test.example.com/tracks/test3.mp3', 3, ARRAY['test', 'rock']),
  
  -- Tracks for Test Album 2
  ('20000000-0000-0000-0000-000000000004', 'Test Track 4', '00000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000002', 240, 'https://test.example.com/tracks/test4.mp3', 1, ARRAY['test', 'pop']),
  ('20000000-0000-0000-0000-000000000005', 'Test Track 5', '00000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000002', 220, 'https://test.example.com/tracks/test5.mp3', 2, ARRAY['test', 'pop']),
  
  -- Tracks for Test Album 3
  ('20000000-0000-0000-0000-000000000006', 'Test Track 6', '00000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000003', 300, 'https://test.example.com/tracks/test6.mp3', 1, ARRAY['test', 'electronic']),
  ('20000000-0000-0000-0000-000000000007', 'Test Track 7', '00000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000003', 270, 'https://test.example.com/tracks/test7.mp3', 2, ARRAY['test', 'electronic']),
  ('20000000-0000-0000-0000-000000000008', 'Test Track 8', '00000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000003', 315, 'https://test.example.com/tracks/test8.mp3', 3, ARRAY['test', 'electronic'])
ON CONFLICT (id) DO NOTHING;

-- Create test playlists
INSERT INTO prettygood.playlists (
  id, name, description, user_id, is_public, collaborative
) VALUES
  ('30000000-0000-0000-0000-000000000001', 'Test Playlist 1', 'A test playlist for development', '00000000-0000-0000-0000-000000000004', TRUE, FALSE),
  ('30000000-0000-0000-0000-000000000002', 'Test Playlist 2', 'Another test playlist', '00000000-0000-0000-0000-000000000005', TRUE, FALSE),
  ('30000000-0000-0000-0000-000000000003', 'Collaborative Test Playlist', 'A collaborative test playlist', '00000000-0000-0000-0000-000000000004', TRUE, TRUE)
ON CONFLICT (id) DO NOTHING;

-- Add tracks to test playlists
INSERT INTO prettygood.playlist_tracks (
  playlist_id, track_id, added_by, position
) VALUES
  -- Tracks in Test Playlist 1
  ('30000000-0000-0000-0000-000000000001', '20000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000004', 1),
  ('30000000-0000-0000-0000-000000000001', '20000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000004', 2),
  ('30000000-0000-0000-0000-000000000001', '20000000-0000-0000-0000-000000000006', '00000000-0000-0000-0000-000000000004', 3),
  
  -- Tracks in Test Playlist 2
  ('30000000-0000-0000-0000-000000000002', '20000000-0000-0000-0000-000000000004', '00000000-0000-0000-0000-000000000005', 1),
  ('30000000-0000-0000-0000-000000000002', '20000000-0000-0000-0000-000000000005', '00000000-0000-0000-0000-000000000005', 2),
  ('30000000-0000-0000-0000-000000000002', '20000000-0000-0000-0000-000000000007', '00000000-0000-0000-0000-000000000005', 3),
  
  -- Tracks in Collaborative Test Playlist
  ('30000000-0000-0000-0000-000000000003', '20000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000004', 1),
  ('30000000-0000-0000-0000-000000000003', '20000000-0000-0000-0000-000000000008', '00000000-0000-0000-0000-000000000005', 2)
ON CONFLICT (playlist_id, track_id) DO NOTHING;

-- Add collaborators to the collaborative playlist
INSERT INTO prettygood.playlist_collaborators (
  playlist_id, user_id, added_by
) VALUES
  ('30000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000005', '00000000-0000-0000-0000-000000000004')
ON CONFLICT (playlist_id, user_id) DO NOTHING;

-- Set up some likes and follows for testing
-- User 1 likes tracks and albums
INSERT INTO prettygood.track_likes (track_id, user_id)
VALUES
  ('20000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000004'),
  ('20000000-0000-0000-0000-000000000006', '00000000-0000-0000-0000-000000000004')
ON CONFLICT (track_id, user_id) DO NOTHING;

INSERT INTO prettygood.album_likes (album_id, user_id)
VALUES
  ('10000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000004'),
  ('10000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000004')
ON CONFLICT (album_id, user_id) DO NOTHING;

-- User 2 likes tracks and albums
INSERT INTO prettygood.track_likes (track_id, user_id)
VALUES
  ('20000000-0000-0000-0000-000000000004', '00000000-0000-0000-0000-000000000005'),
  ('20000000-0000-0000-0000-000000000005', '00000000-0000-0000-0000-000000000005')
ON CONFLICT (track_id, user_id) DO NOTHING;

INSERT INTO prettygood.album_likes (album_id, user_id)
VALUES
  ('10000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000005')
ON CONFLICT (album_id, user_id) DO NOTHING;

-- Users follow artists
INSERT INTO prettygood.artist_followers (artist_id, user_id)
VALUES
  ('00000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000004'),
  ('00000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000004'),
  ('00000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000005')
ON CONFLICT (artist_id, user_id) DO NOTHING;

-- Add some play history
INSERT INTO prettygood.play_history (
  track_id, user_id, played_at, play_duration, completed, source
) VALUES
  -- User 1 play history
  ('20000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000004', NOW() - INTERVAL '3 days', 180, TRUE, 'album'),
  ('20000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000004', NOW() - INTERVAL '3 days', 210, TRUE, 'album'),
  ('20000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000004', NOW() - INTERVAL '3 days', 195, TRUE, 'album'),
  ('20000000-0000-0000-0000-000000000006', '00000000-0000-0000-0000-000000000004', NOW() - INTERVAL '2 days', 300, TRUE, 'search'),
  ('20000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000004', NOW() - INTERVAL '1 day', 180, TRUE, 'playlist'),
  
  -- User 2 play history
  ('20000000-0000-0000-0000-000000000004', '00000000-0000-0000-0000-000000000005', NOW() - INTERVAL '4 days', 240, TRUE, 'album'),
  ('20000000-0000-0000-0000-000000000005', '00000000-0000-0000-0000-000000000005', NOW() - INTERVAL '4 days', 220, TRUE, 'album'),
  ('20000000-0000-0000-0000-000000000006', '00000000-0000-0000-0000-000000000005', NOW() - INTERVAL '2 days', 300, FALSE, 'search'),
  ('20000000-0000-0000-0000-000000000004', '00000000-0000-0000-0000-000000000005', NOW() - INTERVAL '1 day', 240, TRUE, 'playlist')
;

-- Add library items for users
INSERT INTO prettygood.user_library_tracks (user_id, track_id)
VALUES
  ('00000000-0000-0000-0000-000000000004', '20000000-0000-0000-0000-000000000001'),
  ('00000000-0000-0000-0000-000000000004', '20000000-0000-0000-0000-000000000002'),
  ('00000000-0000-0000-0000-000000000004', '20000000-0000-0000-0000-000000000003'),
  ('00000000-0000-0000-0000-000000000004', '20000000-0000-0000-0000-000000000006'),
  ('00000000-0000-0000-0000-000000000005', '20000000-0000-0000-0000-000000000004'),
  ('00000000-0000-0000-0000-000000000005', '20000000-0000-0000-0000-000000000005')
ON CONFLICT (user_id, track_id) DO NOTHING;

INSERT INTO prettygood.user_library_albums (user_id, album_id)
VALUES
  ('00000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000001'),
  ('00000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000003'),
  ('00000000-0000-0000-0000-000000000005', '10000000-0000-0000-0000-000000000002')
ON CONFLICT (user_id, album_id) DO NOTHING;

INSERT INTO prettygood.user_library_artists (user_id, artist_id)
VALUES
  ('00000000-0000-0000-0000-000000000004', '00000000-0000-0000-0000-000000000002'),
  ('00000000-0000-0000-0000-000000000004', '00000000-0000-0000-0000-000000000003'),
  ('00000000-0000-0000-0000-000000000005', '00000000-0000-0000-0000-000000000002')
ON CONFLICT (user_id, artist_id) DO NOTHING;

-- Create a test payment
INSERT INTO prettygood.payments (
  id, sender_id, recipient_id, amount, currency, transaction_hash, status, payment_type, track_id, message
) VALUES
  ('40000000-0000-0000-0000-000000000001', 
   '00000000-0000-0000-0000-000000000004', 
   '00000000-0000-0000-0000-000000000002', 
   10.5, 'SUI', 
   '0x0000000000000000000000000000000000000000000000000000000000000001', 
   'completed', 'tip', 
   '20000000-0000-0000-0000-000000000001', 
   'Great track!')
ON CONFLICT (id) DO NOTHING;

-- Print a message
DO $$
BEGIN
  RAISE NOTICE 'Test content created successfully';
  RAISE NOTICE '- 3 Albums added with IDs starting with 100000...';
  RAISE NOTICE '- 8 Tracks added with IDs starting with 200000...';
  RAISE NOTICE '- 3 Playlists added with IDs starting with 300000...';
  RAISE NOTICE '- 1 Test payment added with ID 400000...';
END $$;
